<html><head>
<title>athena 6.3.0a10: Arachne Interface Specification</title>
<style>

        A {
            text-decoration: none;
        }

        TABLE {
            margin-top:    4px;
            margin-bottom: 4px;
        }

        TR {
            vertical-align: baseline;
        }

        TH {
            padding-left: 4px;
        }

        TD {
            padding-left: 4px;
        }

        /* Table Formatting Classes: "pretty" 
         * Border around the outside, even/odd striping, no internal
         * border lines.
         */
        TABLE.pretty {
            border: 1px solid black;
            border-spacing: 0;
        }

        TABLE.pretty TR.header {
            font-weight: bold;
            color: white;
            background-color: #000099;
        }

        TABLE.pretty TR.oddrow {
            color: black;
            background-color: white;
        }

        TABLE.pretty TR.evenrow {
            color: black;
            background-color: #EEEEEE;
        }

        /* Examples, listings, and marks */
        PRE.example {
            background:     #FFFDD1 ;
            border:         1px solid blue;
            padding-top:    2px;
            padding-bottom: 2px;
            padding-left:   4px;
        }

        PRE.listing {
            background:     #FFFDD1 ;
            border:         1px solid blue;
            padding-top:    4px;
            padding-bottom: 4px;
            padding-left:   4px;
        }

        SPAN.linenum {
            background:     #E3E08F ;
        }

        DIV.mark {
            display: inline;
            font-family: Verdana;
            font-size: 75%;
            background: black;
            color: white;
            border: 1px solid black;
            border-radius: 5px;
            padding-left: 2px;
            padding-right: 2px;
        }

        DIV.bigmark {
            display: inline;
            font-family: Verdana;
            font-size: 100%;
            background: black;
            color: white;
            border: 1px solid black;
            border-radius: 5px;
            padding-left: 2px;
            padding-right: 2px;
        }

        /* Topic Lists. */
        TR.topic {
            vertical-align: baseline;
        }

        TR.topicname {
            min-width: 1.5em;
        }

    

        BODY {
            color: black;
            background: white;
            margin-left: 1%;
            margin-right: 1%;
        }
        TABLE {
            width: 100%;
        }
    
</style>
</head>

<body>
<h1 style="background: red;">
&nbsp;athena 6.3.0a10: Athena Regional Stability Simulation
</h1>
    
<h1>Arachne Interface Specification</h1>
    

<b>NOTE:</b> This is a preliminary specification; the Arachne executable
is an incomplete prototype.<p>

<p><hr><p>

<h2>Table of Contents</h2>

<p><b><a href="#changelog" name="toc.changelog">Change Log</a></b></p>


<p><b><a href="#overview" name="toc.overview">1. Overview</a></b></p>

<ul>

    <li><a href="#overview.cloud" name="toc.overview.cloud">1.1 Cloud Assumptions</a></li>

    

    <li><a href="#overview.name" name="toc.overview.name">1.2 Why Arachne?</a></li>

    

</ul>
    
<p><b><a href="#cmdline" name="toc.cmdline">2. Command Line Interface</a></b></p>


<p><b><a href="#restapi" name="toc.restapi">3. RESTful API</a></b></p>

<ul>

    <li><a href="#restapi.ref" name="toc.restapi.ref">3.1 API Reference</a></li>

    

</ul>
    
<p><b><a href="#script" name="toc.script">4. Athena Script Commands</a></b></p>






    

<p><hr><p>


<h2><a name="changelog" href="#toc.changelog">Change Log</a></h2>
    

<table class="pretty" width="100%" cellpadding="5" cellspacing="0">
<tr class="header">
<th align="left" width="10%">Status</th>
<th align="left" width="70%">Nature of Change</th>
<th align="left" width="10%">Date</th>
<th align="left" width="10%">Initiator</th>
</tr>
        

<tr class="oddrow" valign=top>
<td>Update</td>
<td>
Added details about the RESTful API.  Also, Arachne is no longer 
intended for non-server batch runs; <a href="./man1/athena.html">athena(1)</a>'s "build" subcommand
handles that use-case quite nicely.<p>
</td>
<td>4/10/2015</td>
<td>will</td>
</tr>
        

<tr class="evenrow" valign=top>
<td>Update</td>
<td>
Added the <tt>-web</tt> option, which causes the web server to be started;
the <tt>-port</tt> now defaults to 8080.
</td>
<td>4/2/2015</td>
<td>will</td>
</tr>
        

<tr class="oddrow" valign=top>
<td>Update</td>
<td>
<ul>
<li> Arachne assumes all incoming HTTP requests use "https".
     (<a href="#restapi">Section 3</a>).
<li> Added <tt>-heartbeat</tt>, <tt>-heartbeaturl</tt> options.
</ul>
</td>
<td>2/3/2015</td>
<td>will</td>
</tr>
        

<tr class="evenrow" valign=top>
<td>Update</td>
<td>
Preliminary draft
</td>
<td>1/28/2015</td>
<td>will</td>
</tr>
        
</table><p>

<p><hr><p>


<h2><a name="overview" href="#toc.overview">1. Overview</a></h2>
    

Arachne is a version of Athena intended to run as part of a web back-end in
the cloud.  It includes a web server that provides a RESTful interface
to Athena's run-time data.<p>

The purpose of this document is to specify Arachne's command-line and
RESTful interface as an aid to web developers using Arachne in 
production.<p>

<b>NOTE:</b> Arachne is still in development; therefore this document also 
serves to capture the preliminary design and to record decisions made in
discussions with the Web Athena developers.<p>


<h3><a name="overview.cloud" href="#toc.overview.cloud">1.1 Cloud Assumptions</a></h3>
    

Arachne makes the following assumptions about its run-time environment when
run as part of the "Web Athena" back end:<p>

<ul>
<li> Arachne runs on a cloud node, with an instance of Arachne for each
     user session.
<li> The node runs 64-bit Linux (this is negotiable).
<li> Arachne is invoked by the back end software on need.
<li> Arachne communicates with the back end software by means of its 
     command line and RESTful HTTP interface.
<li> Arachne is insulated from the outside network by the enclosing back
     end software (so as to minimize potential security issues).
<li> The enclosing software handles file management, i.e., archiving of 
     Athena scenario results.
</ul>


<h3><a name="overview.name" href="#toc.overview.name">1.2 Why Arachne?</a></h3>
    

In Greek myth, Arachne was so skilled at spinning thread that she beat
Athena in a fair contest.  In retaliation, Athena turned Arachne into a 
spider.  Arachne is therefore Athena's web-spinner.<p>


<h2><a name="cmdline" href="#toc.cmdline">2. Command Line Interface</a></h2>
    

<b>TBD</b>: This is, of course, quite preliminary.<p>

Arachne is installed as a Linux executable called <b><tt>arachne</tt></b>.
It runs as a server with a RESTful web interface.<p>

To run Arachne simply invoke it, optionally specifying the HTTP 
<tt>-port</tt>, <tt>-public</tt>, and <tt>-heartbeatfile</tt>.  Arachne will load 
any <tt>-scenario</tt> and execute any <tt>-script</tt> for its "base" case, 
and then wait for instructions via HTTP.<p>

To invoke Arache without starting the HTTP server, pass the 
<tt>-test</tt> option.  (This is provided as an aid to testing.)<p>

Arachne takes the following command-line options:<p>

<dl>

<dt><b>-heartbeat <i>seconds</i></b></dt>
<dd>
        

<b>Not Yet Implemented.</b>  Specifies the number of seconds between 
heartbeats.<p>

<dt><b>-heartbeatfile <i>filepath</i></b></dt>
<dd>
        

<b>Not Yet Implemented.</b>  If given, and if Arachne is listening for HTTP 
requests, it will write the 
current time in seconds to the named <i>filepath</i> approximately every 
<tt>-heartbeat</tt> seconds.  This allows the enclosing web application to be 
sure that it is alive.<p>

<dt><b>-heartbeaturl <i>url</i></b></dt>
<dd>
        

<b>Not Yet Implemented.</b>  If given, and if Arachne is listening for 
HTTP requests, it will GET the
specified URL approximately every <tt>-heartbeat</tt> seconds.  This allows the 
enclosing web application to be sure that it is alive.<p>

<dt><b>-public</b></dt>
<dd>
        

<b>Not Yet Implemented.</b> 
By default, Arachne only accepts HTTP requests from the local host.  If
this option is given, Arachne will accept HTTP requests from other hosts.<p>

<dt><b>-port <i>portid</i></b></dt>
<dd>
        

Specifies the port ID at which Arachne should listen for HTTP requests.
Defaults to port 8080.
<b>TBD:</b> Ultimately, Arachne will accept only HTTPS request; at present,
we are waiting on a bug fix in the Tcl TLS package, so we list for 
normal HTTP requests.<p>

<dt><b>-scenariodir <i>dirpath</i></b></dt>
<dd>
        
Specifies the name of a directory from which Arachne will import and 
export Athena scenario (.adb) files and scenario script (.tcl) files at 
run-time.  The larger application can stage and retrieve files using
this directory.<p>

<dt><b>-scenario <i>filepath</i></b></dt>
<dd>
        

Specifies the path to an Athena scenario (.adb) file to load at start-up
as Arachne's base case, "<tt>case00</tt>".  It is usual to begin with a base 
scenario and then run excursions from it via the RESTful API.<p>

If no <tt>-scenario</tt> is specified, then Arachne creates an empty scenario
for "<tt>case00</tt>".<p>

<dt><b>-script <i>filepath</i></b></dt>
<dd>
        

Specifies the path to an Athena script (.tcl) file to load into the
base case at start-up. Any <tt>-scenario</tt> is loaded into "<tt>case00</tt>" 
first.<p> 

<b>TBD:</b> The RESTful interface is importing scenario files and scenario
scripts interchangeably, based on the file type.  The 
<tt>-scenario</tt>/<tt>-script</tt> option pair is mostly of use for batch
processing, for which Arachne no longer responsible; perhaps we should 
remove <tt>-script</tt> and let <tt>-scenario</tt> be either a .adb or .tcl 
file.<p>

<dt><b>-noweb</b></dt>
<dd>
        

If this option is specified, Arachne will halt immediately after loading the
<tt>-scenario</tt> and executing the <tt>-script</tt>.  This is provided as an
aid to testing.<p>

</dl>


<h2><a name="restapi" href="#toc.restapi">3. RESTful API</a></h2>
    

When Arachne is run with the <tt>-port</tt> command line option, it will 
initialize its RESTful HTTP interface, which can be accessed at 
<tt>https://127.0.0.1:<i>portid</i></tt>.<p>  

By default, the HTTP interface can only be accessed from the local host.
If the <tt>-public</tt> option is given, then the HTTP interface
can be accessed from other hosts on the network.<p>

The set of URLs and HTTP operations supported by Arachne is <b>TBD</b>, but
will certainly allow:<p>

<ul>
<li> Controlling scenario execution.
<li> Retrieving overall status information.
<li> Sending Athena executive scripts to Arachne.
<li> Sending Athena orders to Arachne (possibly as scripts)
<li> Requesting run-time results from Arachne
<li> Comparing two scenarios (or one scenario at different times) to
     determine significant deltas.
<li> Requesting explanations of significant deltas in terms of 
     chains of causality. 
</ul> 

Most requests will be GET requests; scripts will generally be sent using 
POST.  However, Arachne isn't terribly concerned about the request type.<p>

Information will be returned to the client as HTML or JSON text.  At
present, we assume that the front-end will do most of its own presentation,
and that the HTML will primarily be for debugging.  The return type will
be indicated by the file extension on the URL, ".html" or ".json".<p>


<h3><a name="restapi.ref" href="#toc.restapi.ref">3.1 API Reference</a></h3>
    

<dl>

<dt><b>/scenario/index.{html,json}</b></dt>
<dd>
        

Arachne will work with multiple Athena scenarios at one time.  This URL
returns an index of data about each scenario: the scenario's ID string,
state, current simulation time, and so forth.  The JSON output is formatted
as a list of objects.<p>

<dt><b>/scenario/<i>name</i>/order.{html,json}</b></dt>
<dd>
        

These URLs are used to send an Athena order to a scenario whose ID is 
<i>name</i>.  The order is sent as the URL query.  The query parameters
are the same as the Athena order parameters, plus the <tt>order_</tt> parameter
which specifies the order's name.<p>

The JSON result is a list of two or three elements.  The first element is a
code, "OK", "REJECT", or "ERROR".<p>

<ul>
<li>  If the code is "OK", the order was
      accepted; the second element is the order's result string, which is 
      typically empty.<p>

<li> If the code is "REJECT", the order was rejected.  The second 
     element is a JSON object with one field for each problem parameter
     in the order.  The field names are parameter names (or "*" for errors
     affecting the whole order); the field values are error messages for
     display to the user.<p>

<li> If the code is "ERROR", there was an unexpected error while executing
     the order.  The second element is an error message, and the third
     element is a stack trace.<p>
</ul>

<dt><b>/scenario/<i>name</i>/script.{html,json}</b></dt>
<dd>
        

These URLs are used to send executive scripts to a scenario whose ID is
<i>name</i>.  The HTML version presents a web form with a <tt>&lt;textarea&gt;</tt>
for entry of a script, and an "Execute" button.  Pressing "Execute" sends
the script, URL-encoded, as the value of the <tt>script</tt> query parameter
and reloads the page.  The script and the result value are displayed, and
the user can then enter and execute another script.<p>

The JSON version accepts the script as POST data in with a content-type of
<tt>text/plain</tt>.  (This can be changed, if desired.)  The script is 
executed, and the result returned to the client in JSON format.   

The JSON result is a list of two or three elements.  The first element is a
code, "OK" or "ERROR".<p>

<ul>
<li>  If the code is "OK", the executed successfully; the second element 
      is the script's result string.<p>

<li> If the code is "ERROR", there was an error while executing
     the script; this usually indicates a problem with the script itself.
     The second element is an error message, and the third
     element is a stack trace.<p>
</ul>


</dl>


<h2><a name="script" href="#toc.script">4. Athena Script Commands</a></h2>
    

The RESTful interface allows executive scripts to be sent to a particular
scenario and executed by it; thus, the executive commands are part of the 
interface specification.  We already have high-quality documentation of
the executive commands as on-line help in the Athena Workbench; our 
plan for now is make this help database available through Arachne's
web interface.  The web developer can then invoke Arachne and browse
its help.<p>

<hr>
<address><a href="mailto:William.H.Duquette@jpl.nasa.gov">William.H.Duquette@jpl.nasa.gov</a></address>
</body>
</html>
    



<!-- List of Anchors
changelog       Change Log
overview        1. Overview
overview.cloud  1.1 Cloud Assumptions
overview.name   1.2 Why Arachne?
cmdline         2. Command Line Interface
restapi         3. RESTful API
restapi.ref     3.1 API Reference
script          4. Athena Script Commands

-->
